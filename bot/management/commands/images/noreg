from django.core.management.base import BaseCommand
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, CallbackQuery
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes
import os
from bot.models import UserRegistration
import asyncio

TELEGRAM_TOKEN = os.getenv("TELEGRAM_TOKEN", "7795385929:AAF98EsKowGgpg9wgEN91qpZZh5x5tLHTcM")

LANGUAGE_SELECTION_IMAGE = "bot/management/commands/images/lang.jpg"
MAIN_MENU_IMAGE = "bot/management/commands/images/menu.jpg"
GAME_MENU_IMAGE = "bot/management/commands/images/games.jpg"

async def delete_previous_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    chat_id = update.effective_chat.id
    if isinstance(update.callback_query, CallbackQuery):
        chat_id = update.callback_query.message.chat_id
        
    previous_message_id = context.user_data.get('previous_message_id')
    if previous_message_id:
        try:
            await context.bot.delete_message(chat_id=chat_id, message_id=previous_message_id)
        except Exception as e:
            print(f"Error deleting message: {e}")
    
    # Also try to delete the message that triggered the callback
    if isinstance(update.callback_query, CallbackQuery):
        try:
            await update.callback_query.message.delete()
        except Exception as e:
            print(f"Error deleting callback message: {e}")

def get_text(context, ru_text, en_text):
    return ru_text if context.user_data.get('language') == 'ru' else en_text

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    await delete_previous_message(update, context)
    
    language_keyboard = [
        [InlineKeyboardButton("ðŸ‡·ðŸ‡º Ð ÑƒÑÑÐºÐ¸Ð¹", callback_data='lang_ru')],
        [InlineKeyboardButton("ðŸ‡¬ðŸ‡§ English", callback_data='lang_en')]
    ]
    reply_markup = InlineKeyboardMarkup(language_keyboard)

    with open(LANGUAGE_SELECTION_IMAGE, 'rb') as photo:
        message = await context.bot.send_photo(
            chat_id=update.effective_chat.id,
            photo=photo,
            caption="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ·Ñ‹Ðº / Choose your language:",
            reply_markup=reply_markup
        )
        context.user_data['previous_message_id'] = message.message_id

async def language_selected(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()

    await delete_previous_message(update, context)

    if query.data == 'lang_ru':
        context.user_data['language'] = 'ru'
    else:
        context.user_data['language'] = 'en'

    await show_main_menu(update, context)

async def show_main_menu(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    await delete_previous_message(update, context)
    
    menu_text = get_text(context, "Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ!", "Welcome to the main menu!")

    main_menu_keyboard = [
        [InlineKeyboardButton(get_text(context, "ðŸŽ® Ð˜Ð³Ñ€Ð°Ñ‚ÑŒ", "ðŸŽ® Play"), callback_data='play')],
        [InlineKeyboardButton(get_text(context, "ðŸ‘¥ ÐšÐ°Ð½Ð°Ð»", "ðŸ‘¥ Channel"), url="https://t.me/txitNGBrugg5MTRi")],
        [InlineKeyboardButton(get_text(context, "ðŸŒ Ð¡Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ ÑÐ·Ñ‹Ðº", "ðŸŒ Change Language"), callback_data='start')]
    ]
    reply_markup = InlineKeyboardMarkup(main_menu_keyboard)

    with open(MAIN_MENU_IMAGE, 'rb') as photo:
        message = await context.bot.send_photo(
            chat_id=update.effective_chat.id,
            photo=photo,
            caption=menu_text,
            reply_markup=reply_markup
        )
        context.user_data['previous_message_id'] = message.message_id

async def play(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()
    await delete_previous_message(update, context)

    if context.user_data.get('done_subscribing', False):
        await show_games_menu(query, context)
    else:
        message = await query.message.reply_text(
            get_text(
                context,
                "ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð½Ð° Ð²ÑÑ‚ÑƒÐ¿Ð»ÐµÐ½Ð¸Ðµ Ð² Ð½Ð°Ñˆ ÐºÐ°Ð½Ð°Ð» Ð¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ 'Ð“Ð¾Ñ‚Ð¾Ð²Ð¾', Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ.",
                "Please send a request to join our channel and click 'Done' to continue."
            ),
            reply_markup=InlineKeyboardMarkup([
                [InlineKeyboardButton(get_text(context, "ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð² ÐºÐ°Ð½Ð°Ð»", "Go to Channel"), url="https://t.me/+txitNGBrugg5MTRi")],
                [InlineKeyboardButton(get_text(context, "Ð“Ð¾Ñ‚Ð¾Ð²Ð¾", "Done"), callback_data='continue_after_subscribe')],
                [InlineKeyboardButton(get_text(context, "ÐÐ°Ð·Ð°Ð´", "Back"), callback_data='show_main_menu')]
            ])
        )
        context.user_data['previous_message_id'] = message.message_id

async def continue_after_subscribe(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()
    await delete_previous_message(update, context)

    context.user_data['done_subscribing'] = True
    message = await query.message.reply_text(
        get_text(
            context,
            "Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾! Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ.",
            "Thank you! You can now continue."
        )
    )
    context.user_data['previous_message_id'] = message.message_id
    
    await asyncio.sleep(2)
    await show_games_menu(query, context)

async def show_games_menu(query, context: ContextTypes.DEFAULT_TYPE) -> None:
    chat_id = query.message.chat.id
    previous_message_id = context.user_data.get('previous_message_id')
    if previous_message_id:
        try:
            await context.bot.delete_message(chat_id=chat_id, message_id=previous_message_id)
        except Exception as e:
            print(f"Error deleting message: {e}")

    games_keyboard = [
        [
            InlineKeyboardButton("âœˆï¸ Aviator", callback_data='game_1'),
            InlineKeyboardButton("ðŸš€ LuckyJet", callback_data='game_2'),
            InlineKeyboardButton("ðŸš— Speed&Cash", callback_data='game_3')
        ],
        [
            InlineKeyboardButton("ðŸ’£ Mines", callback_data='game_4'),
            InlineKeyboardButton("ðŸ‘‘ Royal", callback_data='game_5'),
            InlineKeyboardButton("ðŸª¦ Brawl Pirates", callback_data='game_6')
        ],
        [
            InlineKeyboardButton(get_text(context, "ÐÐ°Ð·Ð°Ð´", "Back"), callback_data='show_main_menu')
        ]
    ]
    reply_markup = InlineKeyboardMarkup(games_keyboard)

    with open(GAME_MENU_IMAGE, 'rb') as photo:
        message = await context.bot.send_photo(
            chat_id=chat_id,
            photo=photo,
            caption=get_text(context, "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸Ð³Ñ€Ñƒ:", "Choose a game:"),
            reply_markup=reply_markup
        )
        context.user_data['previous_message_id'] = message.message_id
        
async def game_selected(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()
    await delete_previous_message(update, context)

    selected_game = query.data.split('_')[-1]

    game_urls = {
        '1': "https://aviator-predictor-tgbot.netlify.app",
        '2': "https://lucky-jet-predictor-tgbot.netlify.app",
        '3': "https://speedandcash-predictor-tgbot.netlify.app",
        '4': "https://mines-predictor-tgbot.netlify.app",
        '5': "https://royal-mines-predictor-tgbot.netlify.app",
        '6': "https://brawl-pirates-predictor-tgbot.netlify.app",
    }

    game_details = {
        '1': {
            'message': get_text(
                context,
                "âœˆï¸ Aviator - ÑÑ‚Ð¾ Ð·Ð°Ñ…Ð²Ð°Ñ‚Ñ‹Ð²Ð°ÑŽÑ‰Ð°Ñ Ð³ÑÐ¼Ð±Ð»Ð¸Ð½Ð³ Ð¸Ð³Ñ€Ð°, Ð³Ð´Ðµ Ð²Ð°ÑˆÐµ Ð¼Ð°ÑÑ‚ÐµÑ€ÑÑ‚Ð²Ð¾ Ð·Ð°ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ÑÑ Ð² Ñ‚Ð¾Ð¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑÐ¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð²Ð°ÑˆÑƒ ÑÑ‚Ð°Ð²ÐºÑƒ Ð´Ð¾ Ð¾Ñ‚Ð»ÐµÑ‚Ð° ÑÐ°Ð¼Ð¾Ð»ÐµÑ‚Ð° Ñ Ð²Ð°ÑˆÐ¸Ð¼Ð¸ Ð´ÐµÐ½ÑŒÐ³Ð°Ð¼Ð¸.\n"
                "Ð§ÐµÐ¼ Ð´Ð¾Ð»ÑŒÑˆÐµ Ð¾Ð½ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð² Ð²Ð¾Ð·Ð´ÑƒÑ…Ðµ, Ñ‚ÐµÐ¼ Ð±Ð¾Ð»ÐµÐµ Ñ‰ÐµÐ´Ñ€Ð¾ Ð¾Ð½ Ð²Ð¾Ð·Ð½Ð°Ð³Ñ€Ð°Ð¶Ð´Ð°ÐµÑ‚ Ð²Ð°Ñ Ð¿Ð¾ Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ð¸ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸.\n"
                "ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð´Ð»Ñ Ð²Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð¸ Ð·Ð°Ð²Ð¾ÐµÐ²Ð°Ð½Ð¸Ñ Ð¿Ð¾Ð±ÐµÐ´Ñ‹ Ð² ÑÑ‚Ð¾Ð¹ Ð·Ð°Ñ…Ð²Ð°Ñ‚Ñ‹Ð²Ð°ÑŽÑ‰ÐµÐ¹ Ð¸Ð³Ñ€Ðµ!\n"
                "ÐÐ°Ñˆ Ð¸Ð½Ð½Ð¾Ð²Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ð¹ Ð±Ð¾Ñ‚, Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð½Ð° Ð¿ÐµÑ€ÐµÐ´Ð¾Ð²Ð¾Ð¹ Ð½ÐµÐ¹Ñ€Ð¾ÑÐµÑ‚Ð¸ Ð¾Ñ‚ OpenAI, Ð¾Ð±Ð»Ð°Ð´Ð°ÐµÑ‚ ÑÐ¿Ð¾ÑÐ¾Ð±Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ Ñ‚Ð¾Ñ‡Ð½Ñ‹Ðµ ÐºÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚Ñ‹ Ñ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð²Ð¿Ð»Ð¾Ñ‚ÑŒ Ð´Ð¾ 85%,\n"
                "Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð²Ð°Ð¼ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð¾Ð±Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ ÑÑ‚Ð°Ð²ÐºÐ¸ Ð¸ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ ÑÐ²Ð¾Ð¸ ÑˆÐ°Ð½ÑÑ‹ Ð½Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ð¸Ð³Ñ€Ñ‹.",
                "âœˆï¸ Aviator is an exciting gambling game where your skill is to plan your bet before the plane flies away with your money.\n"
                "The longer it stays in the air, the more generously it rewards you at the end of the game.\n"
                "Find the optimal moment to invest and win in this thrilling game!\n"
                "Our innovative bot, powered by OpenAI's advanced neural network, can predict accurate odds with up to 85% probability,\n"
                "allowing you to make informed bets and increase your chances of winning."
            ),
            'image': "bot/management/commands/images/aviator.png"
        },
        '2': {
            'message': get_text(
                context,
                "ðŸš€ Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² Ð¼Ð¸Ñ€ Lucky Jet - Ð·Ð°Ñ…Ð²Ð°Ñ‚Ñ‹Ð²Ð°ÑŽÑ‰ÐµÐ¹ Ð³ÑÐ¼Ð±Ð»Ð¸Ð½Ð³ Ð¸Ð³Ñ€Ñ‹, Ð³Ð´Ðµ ÐºÐ°Ð¶Ð´Ð°Ñ Ð²Ð°ÑˆÐ° ÑÑ‚Ð°Ð²ÐºÐ° Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ ÑÐ´ÐµÐ»Ð°Ð½Ð° Ð² Ð³Ð°Ñ€Ð¼Ð¾Ð½Ð¸Ð¸ Ñ Ð¾Ñ‚Ð»ÐµÑ‚Ð¾Ð¼ Ð»ÐµÑ‚ÑÑ‰ÐµÐ³Ð¾ ÑÐ°Ð¼Ð¾Ð»ÐµÑ‚Ð°,\n"
                "ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð½ÐµÑÐµÑ‚ Ð²Ð°ÑˆÐ¸ Ð´ÐµÐ½ÑŒÐ³Ð¸ Ð² Ð½ÐµÐ±ÐµÑÐ°.\n"
                "Ð§ÐµÐ¼ Ð´Ð°Ð»ÑŒÑˆÐµ Ð¿ÑƒÑ‚ÑŒ Ð¿Ñ€Ð¾Ð»ÐµÑ‚Ð°ÐµÑ‚, Ñ‚ÐµÐ¼ Ð±Ð¾Ð»ÐµÐµ Ñ‰ÐµÐ´Ñ€Ñ‹Ð¼ ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ Ð²Ð°Ñˆ Ð²Ñ‹Ð¸Ð³Ñ€Ñ‹Ñˆ Ð¿Ñ€Ð¸ Ð¿Ñ€Ð¸Ð·ÐµÐ¼Ð»ÐµÐ½Ð¸Ð¸.\n"
                "ÐŸÐ¾Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ Ð¼Ð°Ð³Ð¸ÑŽ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð° Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¹ ÑÑ‚Ð°Ð²ÐºÐ¸, ÑƒÐ³Ð°Ð´Ð°Ð¹Ñ‚Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð´Ð»Ñ Ð¿Ð¾Ð±ÐµÐ´Ñ‹, Ð²ÐµÐ´ÑŒ Ð² ÑÑ‚Ð¾Ð¼ Ð°Ð·Ð°Ñ€Ñ‚Ð½Ð¾Ð¼ Ð¿Ð¾Ð»ÐµÑ‚Ðµ ÐºÐ°Ð¶Ð´Ð°Ñ ÑÐµÐºÑƒÐ½Ð´Ð° Ð¸Ð¼ÐµÐµÑ‚ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ!\n"
                "ÐÐ°Ñˆ Ð½Ð°Ð´ÐµÐ¶Ð½Ñ‹Ð¹ Ð±Ð¾Ñ‚ Ð²ÑÐµÐ³Ð´Ð° Ñ€ÑÐ´Ð¾Ð¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ Ð²Ð°Ð¼ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€ Ð¸ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ Ð²Ð°ÑˆÐ¸ ÑˆÐ°Ð½ÑÑ‹ Ð½Ð° Ð¿Ð¾Ð±ÐµÐ´Ñƒ.\n"
                "Ð’ÑÑ‚ÑƒÐ¿Ð°Ð¹Ñ‚Ðµ Ð² Ð¸Ð³Ñ€Ñƒ Ñ Lucky Jet, Ð³Ð´Ðµ ÑƒÐ´Ð°Ñ‡Ð° Ð²ÑÐµÐ³Ð´Ð° Ð½Ð° Ð²Ð°ÑˆÐµÐ¹ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ðµ!",
                "ðŸš€ Welcome to the world of Lucky Jet - an exciting gambling game where every bet you make must be timed with the flight of a plane,\n"
                "that takes your money to the skies.\n"
                "The farther it flies, the greater your reward upon landing.\n"
                "Feel the magic of the perfect bet moment, guess the timing for victory because in this thrilling flight every second counts!\n"
                "Our trusted bot is always there to help you make the right choice and increase your chances of winning.\n"
                "Join the game with Lucky Jet where luck is always on your side!"
            ),
            'image': "bot/management/commands/images/luckyjet.png"
        },
        '3': {
            'message': get_text(
                context,
                "ðŸš— Speed & Cash Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°ÐµÑ‚ Ð·Ð°Ñ…Ð²Ð°Ñ‚Ñ‹Ð²Ð°ÑŽÑ‰Ð¸Ð¹ Ð¸Ð³Ñ€Ð¾Ð²Ð¾Ð¹ Ð¾Ð¿Ñ‹Ñ‚ Ñ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°Ð¼Ð¸ Ð°Ð´Ñ€ÐµÐ½Ð°Ð»Ð¸Ð½Ð° Ð¸ Ð±Ñ‹ÑÑ‚Ñ€Ñ‹Ð¼Ð¸ Ð²Ñ‹Ð¸Ð³Ñ€Ñ‹ÑˆÐ°Ð¼Ð¸.\n"
                "Ð•ÑÐ»Ð¸ Ð²Ð°Ð¼ Ð½Ñ€Ð°Ð²ÑÑ‚ÑÑ Ð³Ð¾Ð½ÐºÐ¸ Ð¸ Ð°Ð·Ð°Ñ€Ñ‚Ð½Ñ‹Ðµ Ð¸Ð³Ñ€Ñ‹, ÑÑ‚Ð° Ð¸Ð³Ñ€Ð° Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚Ð»Ð¸Ñ‡Ð½Ñ‹Ð¼ Ð²Ñ‹Ð±Ð¾Ñ€Ð¾Ð¼!\n"
                "ÐÐ°Ñˆ Ð¸Ð½Ð½Ð¾Ð²Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ð¹ Ð±Ð¾Ñ‚, Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð½Ð° Ð¿ÐµÑ€ÐµÐ´Ð¾Ð²Ð¾Ð¹ Ð½ÐµÐ¹Ñ€Ð¾ÑÐµÑ‚Ð¸ Ð¾Ñ‚ ÐžÑ€ÐµÐ¿Ð°, Ð¾Ð±Ð»Ð°Ð´Ð°ÐµÑ‚ ÑÐ¿Ð¾ÑÐ¾Ð±Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ Ñ‚Ð¾Ñ‡Ð½Ñ‹Ðµ ÐºÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚Ñ‹ Ñ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð²Ð¿Ð»Ð¾Ñ‚ÑŒ Ð´Ð¾ 85%,\n"
                "Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð²Ð°Ð¼ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð¾Ð±Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ ÑÑ‚Ð°Ð²ÐºÐ¸ Ð¸ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ ÑÐ²Ð¾Ð¸ ÑˆÐ°Ð½ÑÑ‹ Ð½Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ð¸Ð³Ñ€Ñ‹.",
                "ðŸš— Speed & Cash offers an exciting gaming experience with elements of adrenaline and quick wins.\n"
                "If you enjoy racing and gambling, this game could be a great choice!\n"
                "Our innovative bot, based on advanced neural network technology, has the ability to predict accurate odds with up to 85% probability,\n"
                "allowing you to make informed bets and increase your chances of successful game completion."
            ),
            'image': "bot/management/commands/images/speed_and_cash.png"
        },
        '4': {
            'message': get_text(
                context,
                "ðŸ’£ Mines - ÑÑ‚Ð¾ ÑƒÐ²Ð»ÐµÐºÐ°Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð³ÑÐ¼Ð±Ð»Ð¸Ð½Ð³ Ð¸Ð³Ñ€Ð°, Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°Ñ Ð² Ð±ÑƒÐºÐ¼ÐµÐºÐµÑ€ÑÐºÐ¾Ð¹ ÐºÐ¾Ð½Ñ‚Ð¾Ñ€Ðµ 1 win, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð²Ð´Ð¾Ñ…Ð½Ð¾Ð²Ð»ÐµÐ½Ð° ÐºÐ»Ð°ÑÑÐ¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð¸Ð³Ñ€Ð¾Ð¹ Ð¡Ð°Ð¿ÐµÑ€.\n"
                "Ð’Ð°ÑˆÐ° Ð·Ð°Ð´Ð°Ñ‡Ð° ÑÐ¾ÑÑ‚Ð¾Ð¸Ñ‚ Ð² Ñ‚Ð¾Ð¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°Ñ‚ÑŒ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ðµ ÑÑ‡ÐµÐ¹ÐºÐ¸, Ð¸Ð·Ð±ÐµÐ³Ð°Ñ Ð¿Ð¾Ð¿Ð°Ð´Ð°Ð½Ð¸Ñ Ð² Ð»Ð¾Ð²ÑƒÑˆÐºÐ¸.\n"
                "ÐÐ°Ñˆ ÑƒÐ¼Ð½Ñ‹Ð¹ Ð±Ð¾Ñ‚, Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð½Ñ‹Ð¹ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð½ÐµÐ¹Ñ€Ð¾ÑÐµÑ‚Ð¸ Ð¾Ñ‚ ÐžÑ€ÐµÐ¿Ð°, Ð¾Ð±Ð»Ð°Ð´Ð°ÐµÑ‚ ÑƒÐ´Ð¸Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð±Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¿Ñ€ÐµÐ´ÑƒÐ³Ð°Ð´Ñ‹Ð²Ð°Ñ‚ÑŒ Ñ€Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð·Ð²ÐµÐ·Ð´ Ð½Ð° Ð¿Ð¾Ð»Ðµ Ñ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð² 85%.\n"
                "Ð”Ð¾Ð²ÐµÑ€ÑŒÑ‚ÐµÑÑŒ ÐµÐ³Ð¾ Ð¸Ð½Ñ‚ÑƒÐ¸Ñ†Ð¸Ð¸ Ð¸ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ ÑÐ²Ð¾Ð¸ ÑˆÐ°Ð½ÑÑ‹ Ð½Ð° Ð¿Ð¾Ð±ÐµÐ´Ñƒ.\n"
                "ÐŸÐ¾Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÐµÑÑŒ Ð² Ð·Ð°Ñ…Ð²Ð°Ñ‚Ñ‹Ð²Ð°ÑŽÑ‰Ð¸Ð¹ Ð¼Ð¸Ñ€ Mines Ð¸ Ð¸ÑÐ¿Ñ‹Ñ‚Ð°Ð¹Ñ‚Ðµ ÑÐ²Ð¾ÑŽ ÑƒÐ´Ð°Ñ‡Ñƒ Ð¿Ñ€ÑÐ¼Ð¾ ÑÐµÐ¹Ñ‡Ð°Ñ!\n"
                "Ð‘Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð¿Ñ€Ð¾Ð³Ð½Ð¾Ð·Ð° - 1 Ð¼Ð¸Ð½ÑƒÑ‚Ð°",
                "ðŸ’£ Mines is an exciting gambling game available at 1 win bookmaker, inspired by the classic Minesweeper game.\n"
                "Your goal is to open safe cells, avoiding traps.\n"
                "Our smart bot, developed on a neural network basis, has an amazing ability to predict the location of stars with an 85% probability.\n"
                "Trust its intuition and strategy to increase your chances of winning.\n"
                "Dive into the thrilling world of Mines and test your luck right now!\n"
                "The nearest forecast time is 1 minute."
            ),
            'image': "bot/management/commands/images/mines.png"
        },
        '5': {
            'message': get_text(
                context,
                "ðŸ‘‘ Royal Mines - ÑÑ‚Ð¾ ÑƒÐ²Ð»ÐµÐºÐ°Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð³ÑÐ¼Ð±Ð»Ð¸Ð½Ð³ Ð¸Ð³Ñ€Ð°, Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°Ñ Ð² Ð±ÑƒÐºÐ¼ÐµÐºÐµÑ€ÑÐºÐ¾Ð¹ ÐºÐ¾Ð½Ñ‚Ð¾Ñ€Ðµ Twin, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð²Ð´Ð¾Ñ…Ð½Ð¾Ð²Ð»ÐµÐ½Ð° ÐºÐ»Ð°ÑÑÐ¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð¸Ð³Ñ€Ð¾Ð¹ Ð¡Ð°Ð¿Ñ‘Ñ€.\n"
                "Ð’Ð°ÑˆÐ° Ð·Ð°Ð´Ð°Ñ‡Ð° ÑÐ¾ÑÑ‚Ð¾Ð¸Ñ‚ Ð² Ñ‚Ð¾Ð¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°Ñ‚ÑŒ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ðµ ÑÑ‡ÐµÐ¹ÐºÐ¸, Ð¸Ð·Ð±ÐµÐ³Ð°Ñ Ð¿Ð¾Ð¿Ð°Ð´Ð°Ð½Ð¸Ñ Ð² Ð»Ð¾Ð²ÑƒÑˆÐºÐ¸.\n"
                "ÐÐ°Ñˆ ÑƒÐ¼Ð½Ñ‹Ð¹ Ð±Ð¾Ñ‚, Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð½Ñ‹Ð¹ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð½ÐµÐ¹Ñ€Ð¾ÑÐµÑ‚Ð¸ Ð¾Ñ‚ ÐžÑ€ÐµÐ¿Ð°, Ð¾Ð±Ð»Ð°Ð´Ð°ÐµÑ‚ ÑƒÐ´Ð¸Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð±Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¿Ñ€ÐµÐ´ÑƒÐ³Ð°Ð´Ñ‹Ð²Ð°Ñ‚ÑŒ Ñ€Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð±Ð¾Ð¼Ð± Ð½Ð° Ð¿Ð¾Ð»Ðµ Ñ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒÑŽ > 85%.\n"
                "Ð”Ð¾Ð²ÐµÑ€ÑŒÑ‚ÐµÑÑŒ ÐµÐ³Ð¾ Ð¸Ð½Ñ‚ÑƒÐ¸Ñ†Ð¸Ð¸ Ð¸ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ ÑÐ²Ð¾Ð¸ ÑˆÐ°Ð½ÑÑ‹ Ð½Ð° Ð¿Ð¾Ð±ÐµÐ´Ñƒ.\n"
                "ÐŸÐ¾Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÐµÑÑŒ Ð² Ð·Ð°Ñ…Ð²Ð°Ñ‚Ñ‹Ð²Ð°ÑŽÑ‰Ð¸Ð¹ Ð¼Ð¸Ñ€ Royal Mines Ð¸ Ð¸ÑÐ¿Ñ‹Ñ‚Ð°Ð¹Ñ‚Ðµ ÑÐ²Ð¾ÑŽ ÑƒÐ´Ð°Ñ‡Ñƒ Ð¿Ñ€ÑÐ¼Ð¾ ÑÐµÐ¹Ñ‡Ð°Ñ!\n"
                "Ð‘Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð¿Ñ€Ð¾Ð³Ð½Ð¾Ð·Ð° - 1 Ð¼Ð¸Ð½ÑƒÑ‚Ð°",
                "ðŸ‘‘ Royal Mines is an exciting gambling game available at Twin bookmaker, inspired by the classic game Mines.\n"
                "Your task is to open safe cells, avoiding falling into traps.\n"
                "Our smart bot, developed on the basis of the neural network from Orep, has an amazing ability to predict the location of bombs on the field with a probability of > 85%.\n"
                "Trust its intuition and strategy to increase your chances of winning.\n"
                "Dive into the exciting world of Royal Mines and try your luck right now!\n"
                "The nearest forecast time is 1 minute."
            ),
            'image': "bot/management/commands/images/royal.png"
        },
        '6': {
            'message': get_text(
                context,
                "ðŸª¦ Brawl Pirates - ÑÑ‚Ð¾ Ð¸Ð³Ñ€Ð° Ð² Ð±ÑƒÐºÐ¼ÐµÐºÐµÑ€ÑÐºÐ¾Ð¹ ÐºÐ¾Ð½Ñ‚Ð¾Ñ€Ðµ Twin, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð¾ÑÐ½Ð¾Ð²Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð½Ð° Ð²Ñ‹Ð±Ð¾Ñ€Ðµ Ð§ÐµÑ€ÐµÐ¿Ð°.\n"
                "Ð’ ÑÑ‚Ð¾Ð¹ Ð¸Ð³Ñ€Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ ÑÐ¼Ð¾Ð³ÑƒÑ‚ Ð¸ÑÐ¿Ñ‹Ñ‚Ð°Ñ‚ÑŒ ÑÐ²Ð¾ÑŽ ÑƒÐ´Ð°Ñ‡Ñƒ Ð¸ Ð½Ð°Ð¹Ñ‚Ð¸ ÑÐ¾ÐºÑ€Ð¾Ð²Ð¸Ñ‰Ð° Ð¿Ð¸Ñ€Ð°Ñ‚Ð¾Ð², Ð²Ñ‹Ð¸Ð³Ñ€Ð°Ð² Ñ‚ÐµÐ¼ ÑÐ°Ð¼Ñ‹Ð¼ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð´ÐµÐ½ÑŒÐ³Ð¸.\n"
                "Ð˜Ð³Ñ€Ð° Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°ÐµÑ‚ ÐºÐ°Ð¶Ð´Ð¾Ð¼Ñƒ Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð¾Ð´Ð¸Ð½ Ð¸Ð· Ñ‚Ñ€ÐµÑ… Ñ‡ÐµÑ€ÐµÐ¿Ð¾Ð² Ð¸ ÑƒÐ³Ð°Ð´Ð°Ñ‚ÑŒ, Ð² ÐºÐ°ÐºÐ¾Ð¼ Ð¸Ð· Ð½Ð¸Ñ… Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ ÑÐ¾ÐºÑ€Ð¾Ð²Ð¸Ñ‰Ðµ.\n"
                "ÐÐ°Ñˆ Ð±Ð¾Ñ‚ Ð¾ÑÐ½Ð¾Ð²Ð°Ð½ Ð½Ð° Ð½ÐµÐ¹Ñ€Ð¾ÑÐµÑ‚Ð¸. ÐžÐ½ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ñ€ÐµÐ´ÑƒÐ³Ð°Ð´Ð°Ñ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ñ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒÑŽ 97%.\n"
                "Ð‘Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð¿Ñ€Ð¾Ð³Ð½Ð¾Ð·Ð° - 1 Ð¼Ð¸Ð½ÑƒÑ‚Ð°",
                "ðŸª¦ Brawl Pirates is a game at the Twin bookmaker, based on Skull selection.\n"
                "In this game, users can test their luck and find pirate treasures to win real money.\n"
                "The game offers each player the chance to choose one of three skulls and guess where the treasure is hidden.\n"
                "Our bot, based on a neural network, can predict the outcome with a 97% probability.\n"
                "The nearest forecast time is 1 minute."
            ),
            'image': "bot/management/commands/images/brawl_pirates.png"
        }
    }
    

    game_info = game_details.get(selected_game)
    if game_info:
        web_app_url = game_urls.get(selected_game)
        with open(game_info['image'], 'rb') as photo:
            message = await context.bot.send_photo(
                chat_id=query.message.chat.id,
                photo=photo,
                caption=game_info['message'],
                reply_markup=InlineKeyboardMarkup([
                    [InlineKeyboardButton(get_text(context, "ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐ¸Ð³Ð½Ð°Ð»", "Get Signal"), 
                                        web_app={"url": web_app_url})],
                    [InlineKeyboardButton(get_text(context, "ÐÐ°Ð·Ð°Ð´", "Back"), 
                                        callback_data='go_back')]
                ])
            )
            context.user_data['previous_message_id'] = message.message_id
    else:
        message = await query.message.reply_text(
            get_text(context, "Ð˜Ð·Ð²Ð¸Ð½Ð¸Ñ‚Ðµ, Ð½Ðµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð½Ð°Ð¹Ñ‚Ð¸ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð´Ð»Ñ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð¹ Ð¸Ð³Ñ€Ñ‹.", 
                    "Sorry, information for the selected game could not be found.")
        )
        context.user_data['previous_message_id'] = message.message_id

async def go_back(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()
    await delete_previous_message(update, context)
    await show_games_menu(query, context)

async def change_language(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()
    await delete_previous_message(update, context)
    await start(update, context)

class Command(BaseCommand):
    help = 'Telegram Bot'

    def handle(self, *args, **kwargs):
        application = Application.builder().token(TELEGRAM_TOKEN).build()

        application.add_handler(CommandHandler("start", start))
        application.add_handler(CallbackQueryHandler(language_selected, pattern="^lang_"))
        application.add_handler(CallbackQueryHandler(change_language, pattern="^lang_change$"))
        application.add_handler(CallbackQueryHandler(play, pattern="^play$"))
        application.add_handler(CallbackQueryHandler(go_back, pattern="^go_back$"))
        application.add_handler(CallbackQueryHandler(game_selected, pattern="^game_"))
        application.add_handler(CallbackQueryHandler(start, pattern="^start$"))
        application.add_handler(CallbackQueryHandler(show_main_menu, pattern="^show_main_menu$"))
        application.add_handler(CallbackQueryHandler(continue_after_subscribe, pattern="^continue_after_subscribe$"))

        application.run_polling()